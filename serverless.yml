service: uaipy-core

provider:
  name: aws
  runtime: nodejs18.x
  stage: ${opt:stage, "local"}
  environment: ${file(./config/environments/env.${self:provider.stage}.json)}
  apiGateway:
    apiKeys:
      - device:
          - deviceApiKey
      - client:
          - clientApiKey
    usagePlan:
      - device:
          quota:
            limit: 5000
            offset: 2
            period: MONTH
          throttle:
            burstLimit: 200
            rateLimit: 100
      - client:
          quota:
            limit: 5000
            offset: 2
            period: MONTH
          throttle:
            burstLimit: 200
            rateLimit: 100
plugins:
  - serverless-plugin-typescript
  - serverless-offline

build:
  esbuild: false

functions:
  getUsers:
    handler: src/infra/functions/user/getUsersFunction.handler

  createUser:
    handler: src/infra/functions/user/createUserFunction.handler
    events:
      - http:
          path: user
          method: POST
          private: true
          cors: false

  hello:
    handler: src/infra/functions/helloFunction.handler
    events:
      - http:
          path: hello
          method: GET
          private: true
          cors: false
  
  auth:
    handler: src/infra/functions/authFunction.handler
    events:
      - http:
          path: auth
          method: POST
          private: true
          cors: false

  authVerifier:
    handler: src/infra/functions/authVerifier.handler
    events:
      - http:
          path: auth/verifier
          method: POST
          private: true
          cors: false